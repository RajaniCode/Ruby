<!doctype html>
<html lang="en">








<head>
  <title>Ruby on Rails &mdash; This Week in Rails: 7.1 beta release, Bun support and more!</title>
  <meta charset="utf-8" />
  <meta content="ie=edge" http-equiv="x-ua-compatible" />
  <meta name="handheldfriendly" content="true" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Hi, it’s Greg, bring you the latest changes in the Rails codebase." />

  <meta property="og:site_name" content="Ruby on Rails" />
  <meta property="og:title" content="This Week in Rails: 7.1 beta release, Bun support and more!" />
  <meta property="og:description" content="Hi, it’s Greg, bring you the latest changes in the Rails codebase." />
  <meta property="og:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta property="og:url" content="http://localhost:4000/2023/9/15/this-week-in-rails" />
  <meta property="og:type" content="article" />

  <meta name="twitter:title" content="This Week in Rails: 7.1 beta release, Bun support and more!" />
  <meta name="twitter:description" content="Hi, it’s Greg, bring you the latest changes in the Rails codebase." />
  <meta name="twitter:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@rails" />
  <meta name="twitter:image:alt" content="Ruby on Rails" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/2023/9/15/this-week-in-rails"
      },
      "name": "Ruby on Rails",
      "headline": "This Week in Rails: 7.1 beta release, Bun support and more!",
      "description": "Hi, it’s Greg, bring you the latest changes in the Rails codebase.",
      "url": "http://localhost:4000/2023/9/15/this-week-in-rails",
      "image": "http://localhost:4000/assets/images/opengraph.png",
      "author": {
        "@type": "Person",
        "name": "greg"
      },
      "datePublished": "2023-09-15T00:00:00+05:30"
    }
  </script>
  <script defer data-domain="rubyonrails.org" src="https://plausible.io/js/script.js"></script>
  <link rel="icon" href="/assets/images/favicon.png" />
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="The official Ruby on Rails blog">
</head>


<body>


<nav class="nav">
  <a class="nav__logo" href="/" aria-label="Ruby on Rails"></a>

  <input class="nav__checkbox" id="nav__checkbox" type="checkbox" role="button" aria-label="menu" />

  <label class="nav__toggle" for="nav__checkbox">
    <span></span>
  </label>

  <div class="nav__options">
    <div>
      <ul>
        
          
            <li><a href="https://github.com/rails/rails"><span>Source</span></a></li>
          
        
          
            <li><a href="/docs"><span>Docs</span></a></li>
          
        
          
            <li><a href="/community"><span>Community</span></a></li>
          
        
          
            <li><a href="/blog"><span>News</span></a></li>
          
        
      </ul>

      <ul>
        
          
            <li><a href="/world"><span>Events</span></a></li>
          
        
          
            <li><a href="https://jobs.rubyonrails.org"><span>Jobs</span></a></li>
          
        
          
            <li><a href="https://merch.rubyonrails.org"><span>Merch</span></a></li>
          
        
          
            <li><a href="/foundation"><span>Foundation</span></a></li>
          
        
      </ul>
    </div>
  </div>
</nav>


<div class="layout">
  <div class="post common-padding--bottom common-padding--top-small">
    <div class="container">
      <div class="post__headline common-headline">
        <h5>Friday, September 15, 2023</h5>
        <h2>This Week in Rails: 7.1 beta release, Bun support and more!</h2>

        <h6>Posted by greg</h6>

      </div>
      <div class="post__content common-content common-content--post">
        <p>Hi, it’s <a href="https://greg.molnar.io">Greg</a>, bring you the latest changes in the Rails codebase.</p>

<p><a href="https://rubyonrails.org/2023/9/13/Rails-7-1-0-beta-1-has-been-released">Rails 7.1 beta release</a><br />
The first beta version of Rails 7.1 has been released! There have been over five thousand commits made by over 800 contributors since Rails 7.0, so this release is packed with new features and improvements. You can read a summary of the changes in the announcement.</p>

<p><a href="https://github.com/rails/rails/pull/49278">Ignore env files (except templates)</a><br />
To prevent accidentally leaking secrets to code repositories, the default <em>.gitignore</em> file excludes <em>.env</em>(except template ones) files from now on.</p>

<p><a href="https://github.com/rails/rails/pull/49264">Explicit <em>primary_key:</em> option should always take priority in associations</a><br />
This pull request fixes the issue where the <code class="language-plaintext highlighter-rouge">primary_key:</code> option was ignored if the associated model had a <code class="language-plaintext highlighter-rouge">query_constraints</code> configured. Now <code class="language-plaintext highlighter-rouge">primary_key:</code> option always takes priority, and only if there is no <code class="language-plaintext highlighter-rouge">primary_key:</code> option, the <code class="language-plaintext highlighter-rouge">query_constraints</code> are used to determine the <code class="language-plaintext highlighter-rouge">association_primary_key</code> value.</p>

<p><a href="https://github.com/rails/rails/pull/49192">Instrument Active Record transactions</a><br />
This pull request adds a new <code class="language-plaintext highlighter-rouge">transaction.active_record</code> event to track when Active Record-managed transactions occur. It includes the connection in the payload (useful, for example, in differentiating transactions to different databases),</p>

<p><a href="https://github.com/rails/rails/pull/49241">Add Bun support</a><br />
Bun is a new and viable alternative to the node.js runtime, yarn package manager, and esbuild bundler. Bun’s primary differentiating characteristic is speed. It’s often multiple times faster than node.js and friends.<br />
Since most vanilla Rails projects are looking to simply sprinkle a little JavaScript here and there (but sometimes want a bit better more of the JavaScript ecosystem than the import-maps provide) Bun is a really good fit and can be easily adopted by new rails projects.</p>

<p><a href="https://github.com/rails/rails/pull/49205">Add dedicated guide for composite primary keys</a><br />
This pull request adds a dedicated guide for composite primary key usage.<br />
Besides the dedicated guide, <a href="https://github.com/rails/rails/pull/49218">#49218</a> added a suggestion to use composite primary keys on join tables of <code class="language-plaintext highlighter-rouge">:through</code> associations.</p>

<p><a href="https://github.com/rails/rails/pull/47637">Support composite foreign keys via migration helpers</a><br />
The Rails migration helpers now support composite primary keys. A few examples of using them:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assuming "carts" table has "(shop_id, id)" as a primary key.</span>
<span class="n">add_foreign_key</span><span class="p">(</span><span class="ss">:orders</span><span class="p">,</span> <span class="ss">:carts</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="p">[</span><span class="ss">:shop_id</span><span class="p">,</span> <span class="ss">:id</span><span class="p">])</span>
<span class="c1"># or</span>
<span class="n">add_foreign_key</span><span class="p">(</span><span class="ss">:orders</span><span class="p">,</span> <span class="ss">:carts</span><span class="p">,</span> <span class="ss">column: </span><span class="p">[</span><span class="ss">:cart_shop_id</span><span class="p">,</span> <span class="ss">:cart_id</span><span class="p">])</span>

<span class="n">remove_foreign_key</span><span class="p">(</span><span class="ss">:orders</span><span class="p">,</span> <span class="ss">:carts</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="p">[</span><span class="ss">:shop_id</span><span class="p">,</span> <span class="ss">:id</span><span class="p">])</span>
<span class="n">foreign_key_exists?</span><span class="p">(</span><span class="ss">:orders</span><span class="p">,</span> <span class="ss">:carts</span><span class="p">,</span> <span class="ss">primary_key: </span><span class="p">[</span><span class="ss">:shop_id</span><span class="p">,</span> <span class="ss">:id</span><span class="p">])</span>
</code></pre></div></div>

<p><a href="https://github.com/rails/rails/pull/49193">Add “Testing View Partials” section to the Testing Guides</a><br />
A “Testing View Partials” section is added to the guides that expand upon the variety of tooling available to tests that inherit from <code class="language-plaintext highlighter-rouge">ActionView::TestCase</code>.</p>

<p><a href="https://github.com/rails/rails/pull/49178">Adds support for <em>if_not_exists</em> when adding a check constraint.</a><br />
The <code class="language-plaintext highlighter-rouge">add_check_constraint</code> method now accepts an <code class="language-plaintext highlighter-rouge">if_not_exists</code> option. If set to <em>true</em> an error won’t be raised if the check constraint already exists. In addition, <code class="language-plaintext highlighter-rouge">if_exists</code> and <code class="language-plaintext highlighter-rouge">if_not_exists</code> options are transposed if set when reversing <code class="language-plaintext highlighter-rouge">remove_check_constraint</code> and <code class="language-plaintext highlighter-rouge">add_check_constraint</code>. This enables the simple creation of idempotent, non-transactional migrations.</p>

<p><a href="https://github.com/rails/rails/pull/49072">Encryption: support <em>support_unencrypted_data</em> at a per-attribute level</a><br />
If <code class="language-plaintext highlighter-rouge">ActiveRecord::Encryption.config.support_unencrypted_data</code> is enabled, this change allows you to override that global setting on an attribute should you need.</p>

<p><a href="https://github.com/rails/rails/pull/47752">Raise error when generating attribute with a dangerous name</a><br />
Generating a model with attributes named <code class="language-plaintext highlighter-rouge">hash</code> or <code class="language-plaintext highlighter-rouge">save</code> should raise an error instead of generating a migration with an invalid attribute, and this pull request made that happen.</p>

<p><em>You can view the whole list of changes <a href="https://github.com/rails/rails/compare/@%7B2023-09-08%7D...main@%7B2023-09-15%7D">here</a>.</em>
<em>We had <a href="https://contributors.rubyonrails.org/contributors/in-time-window/20230908-20230915">28 contributors</a> to the Rails codebase this past week!</em></p>

<p>Until next time!</p>


      </div>
    </div>
  </div>
</div>

<footer class="footer common-background--grey common-padding--bottom common-padding--top common-shape--top-white-up-left">
  <div class="footer__logo"><a href="/" aria-label="Ruby on Rails"></a></div>

  
</footer>

</body>
</html>
