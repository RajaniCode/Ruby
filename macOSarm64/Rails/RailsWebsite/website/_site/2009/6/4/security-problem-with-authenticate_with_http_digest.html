<!doctype html>
<html lang="en">








<head>
  <title>Ruby on Rails &mdash; Security Problem with authenticate_with_http_digest</title>
  <meta charset="utf-8" />
  <meta content="ie=edge" http-equiv="x-ua-compatible" />
  <meta name="handheldfriendly" content="true" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A security problem has been reported with the digest authentication code in Ruby on Rails.  This vulnerability can allow users to bypass your password protection.  This vulnerability has been publicly disclosed on several websites, users are advised to take the mitigating steps described below immediately.The issue comes from the handling of the block passed to authenticate_or_request_with_http_digest.  This block must return the user&#8217;s password in the clear, or a sha1 hash of the user&#8217;s password.  Unfortunately the documentation was unclear on this and the examples cited would return nil if the user was not found.  The correct behaviour if the user doesn&#8217;t exist is to return false.If the return value was nil, rails proceeded to verify this value against the provided password.  Because of this an attacker can provide an invalid username and no password and authentication will succeed.Fixed VersionsWe have altered the behaviour of the relevant code to make nil an authentication failure.  This fix has been pushed to 2-3-stable and will be present in 2.3.3 due to be released in the next few days.  All versions of edge rails after commit 1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0 contain the fix.Steps to Protect your application.Users can protect themselves without upgrading by simply ensuring that their authentication blocks never return nil.  To take an example from the documentation:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username]endShould instead be something like:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username] || falseendDisclosure NotesDue to communication difficulties and a mis-understanding between the reporter and the security team.  This vulnerability has been publicly disclosed on several websites, users are advised to update their applications immediately.  Steps are being taken to ensure that the security email is more reliable in the future.  We regret the nature of this disclosure and will endeavor to ensure it doesn&#8217;t happen again in the future." />

  <meta property="og:site_name" content="Ruby on Rails" />
  <meta property="og:title" content="Security Problem with authenticate_with_http_digest" />
  <meta property="og:description" content="A security problem has been reported with the digest authentication code in Ruby on Rails.  This vulnerability can allow users to bypass your password protection.  This vulnerability has been publicly disclosed on several websites, users are advised to take the mitigating steps described below immediately.The issue comes from the handling of the block passed to authenticate_or_request_with_http_digest.  This block must return the user&#8217;s password in the clear, or a sha1 hash of the user&#8217;s password.  Unfortunately the documentation was unclear on this and the examples cited would return nil if the user was not found.  The correct behaviour if the user doesn&#8217;t exist is to return false.If the return value was nil, rails proceeded to verify this value against the provided password.  Because of this an attacker can provide an invalid username and no password and authentication will succeed.Fixed VersionsWe have altered the behaviour of the relevant code to make nil an authentication failure.  This fix has been pushed to 2-3-stable and will be present in 2.3.3 due to be released in the next few days.  All versions of edge rails after commit 1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0 contain the fix.Steps to Protect your application.Users can protect themselves without upgrading by simply ensuring that their authentication blocks never return nil.  To take an example from the documentation:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username]endShould instead be something like:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username] || falseendDisclosure NotesDue to communication difficulties and a mis-understanding between the reporter and the security team.  This vulnerability has been publicly disclosed on several websites, users are advised to update their applications immediately.  Steps are being taken to ensure that the security email is more reliable in the future.  We regret the nature of this disclosure and will endeavor to ensure it doesn&#8217;t happen again in the future." />
  <meta property="og:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta property="og:url" content="http://localhost:4000/2009/6/4/security-problem-with-authenticate_with_http_digest" />
  <meta property="og:type" content="article" />

  <meta name="twitter:title" content="Security Problem with authenticate_with_http_digest" />
  <meta name="twitter:description" content="A security problem has been reported with the digest authentication code in Ruby on Rails.  This vulnerability can allow users to bypass your password protection.  This vulnerability has been publicly disclosed on several websites, users are advised to take the mitigating steps described below immediately.The issue comes from the handling of the block passed to authenticate_or_request_with_http_digest.  This block must return the user&#8217;s password in the clear, or a sha1 hash of the user&#8217;s password.  Unfortunately the documentation was unclear on this and the examples cited would return nil if the user was not found.  The correct behaviour if the user doesn&#8217;t exist is to return false.If the return value was nil, rails proceeded to verify this value against the provided password.  Because of this an attacker can provide an invalid username and no password and authentication will succeed.Fixed VersionsWe have altered the behaviour of the relevant code to make nil an authentication failure.  This fix has been pushed to 2-3-stable and will be present in 2.3.3 due to be released in the next few days.  All versions of edge rails after commit 1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0 contain the fix.Steps to Protect your application.Users can protect themselves without upgrading by simply ensuring that their authentication blocks never return nil.  To take an example from the documentation:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username]endShould instead be something like:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username] || falseendDisclosure NotesDue to communication difficulties and a mis-understanding between the reporter and the security team.  This vulnerability has been publicly disclosed on several websites, users are advised to update their applications immediately.  Steps are being taken to ensure that the security email is more reliable in the future.  We regret the nature of this disclosure and will endeavor to ensure it doesn&#8217;t happen again in the future." />
  <meta name="twitter:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@rails" />
  <meta name="twitter:image:alt" content="Ruby on Rails" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/2009/6/4/security-problem-with-authenticate_with_http_digest"
      },
      "name": "Ruby on Rails",
      "headline": "Security Problem with authenticate_with_http_digest",
      "description": "A security problem has been reported with the digest authentication code in Ruby on Rails.  This vulnerability can allow users to bypass your password protection.  This vulnerability has been publicly disclosed on several websites, users are advised to take the mitigating steps described below immediately.The issue comes from the handling of the block passed to authenticate_or_request_with_http_digest.  This block must return the user&#8217;s password in the clear, or a sha1 hash of the user&#8217;s password.  Unfortunately the documentation was unclear on this and the examples cited would return nil if the user was not found.  The correct behaviour if the user doesn&#8217;t exist is to return false.If the return value was nil, rails proceeded to verify this value against the provided password.  Because of this an attacker can provide an invalid username and no password and authentication will succeed.Fixed VersionsWe have altered the behaviour of the relevant code to make nil an authentication failure.  This fix has been pushed to 2-3-stable and will be present in 2.3.3 due to be released in the next few days.  All versions of edge rails after commit 1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0 contain the fix.Steps to Protect your application.Users can protect themselves without upgrading by simply ensuring that their authentication blocks never return nil.  To take an example from the documentation:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username]endShould instead be something like:authenticate_or_request_with_http_digest(REALM) do |username|USERS[username] || falseendDisclosure NotesDue to communication difficulties and a mis-understanding between the reporter and the security team.  This vulnerability has been publicly disclosed on several websites, users are advised to update their applications immediately.  Steps are being taken to ensure that the security email is more reliable in the future.  We regret the nature of this disclosure and will endeavor to ensure it doesn&#8217;t happen again in the future.",
      "url": "http://localhost:4000/2009/6/4/security-problem-with-authenticate_with_http_digest",
      "image": "http://localhost:4000/assets/images/opengraph.png",
      "author": {
        "@type": "Person",
        "name": "michael"
      },
      "datePublished": "2009-06-04T03:37:00+05:30"
    }
  </script>
  <script defer data-domain="rubyonrails.org" src="https://plausible.io/js/script.js"></script>
  <link rel="icon" href="/assets/images/favicon.png" />
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="The official Ruby on Rails blog">
</head>


<body>


<nav class="nav">
  <a class="nav__logo" href="/" aria-label="Ruby on Rails"></a>

  <input class="nav__checkbox" id="nav__checkbox" type="checkbox" role="button" aria-label="menu" />

  <label class="nav__toggle" for="nav__checkbox">
    <span></span>
  </label>

  <div class="nav__options">
    <div>
      <ul>
        
          
            <li><a href="https://github.com/rails/rails"><span>Source</span></a></li>
          
        
          
            <li><a href="/docs"><span>Docs</span></a></li>
          
        
          
            <li><a href="/community"><span>Community</span></a></li>
          
        
          
            <li><a href="/blog"><span>News</span></a></li>
          
        
      </ul>

      <ul>
        
          
            <li><a href="/world"><span>Events</span></a></li>
          
        
          
            <li><a href="https://jobs.rubyonrails.org"><span>Jobs</span></a></li>
          
        
          
            <li><a href="https://merch.rubyonrails.org"><span>Merch</span></a></li>
          
        
          
            <li><a href="/foundation"><span>Foundation</span></a></li>
          
        
      </ul>
    </div>
  </div>
</nav>


<div class="layout">
  <div class="post common-padding--bottom common-padding--top-small">
    <div class="container">
      <div class="post__headline common-headline">
        <h5>Thursday, June 4, 2009</h5>
        <h2>Security Problem with authenticate_with_http_digest</h2>

        <h6>Posted by michael</h6>

      </div>
      <div class="post__content common-content common-content--post">
        <p>A security problem has been reported with the digest authentication code in Ruby on Rails.  This vulnerability can allow users to bypass your password protection.  This vulnerability has been publicly disclosed on several websites, users are advised to take the mitigating steps described below immediately.</p>
<p>The issue comes from the handling of the block passed to <ins>authenticate_or_request_with_http_digest</ins>.  This block must return the user&#8217;s password in the clear, or a sha1 hash of the user&#8217;s password.  Unfortunately the documentation was unclear on this and the examples cited would return <strong>nil</strong> if the user was not found.  The correct behaviour if the user doesn&#8217;t exist is to return <strong>false</strong>.</p>
<p>If the return value was nil, rails proceeded to verify this value against the provided password.  Because of this an attacker can provide an invalid username and no password and authentication will succeed.</p>
<h2>Fixed Versions</h2>
<p>We have altered the behaviour of the relevant code to make <ins>nil</ins> an authentication failure.  This fix has been pushed to 2-3-stable and will be present in 2.3.3 due to be released in the next few days.  All versions of edge rails after commit <a href="http://github.com/rails/rails/commit/1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0">1ad57cfe2fbda58439e4b7f84008ad23bc68e8b0</a> contain the fix.</p>
<h2>Steps to Protect your application.</h2>
<p>Users can protect themselves without upgrading by simply ensuring that their authentication blocks never return nil.  To take an example from the documentation:</p>
<p>authenticate_or_request_with_http_digest(<span class="caps">REALM</span>) do |username|
<span class="caps">USERS</span>[username]
end</p>
<p>Should instead be something like:</p>
<p>authenticate_or_request_with_http_digest(<span class="caps">REALM</span>) do |username|
<span class="caps">USERS</span>[username] || false
end</p>
<h2>Disclosure Notes</h2>
<p>Due to communication difficulties and a mis-understanding between the reporter and the security team.  This vulnerability has been publicly disclosed on several websites, users are advised to update their applications immediately.  Steps are being taken to ensure that the security email is more reliable in the future.  We regret the nature of this disclosure and will endeavor to ensure it doesn&#8217;t happen again in the future.</p>

      </div>
    </div>
  </div>
</div>

<footer class="footer common-background--grey common-padding--bottom common-padding--top common-shape--top-white-up-left">
  <div class="footer__logo"><a href="/" aria-label="Ruby on Rails"></a></div>

  
</footer>

</body>
</html>
