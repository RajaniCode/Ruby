<!doctype html>
<html lang="en">








<head>
  <title>Ruby on Rails &mdash; This Week in Rails: Time, Duration fixes and more</title>
  <meta charset="utf-8" />
  <meta content="ie=edge" http-equiv="x-ua-compatible" />
  <meta name="handheldfriendly" content="true" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Happy new year (yet again) ! And a Friday the 13th ðŸ‘»This is Vipul, bringing you the latest from just the second week of the year, which is shaping to be really busy.Thanks to all the 27 contributors, in particular to the 4 people who contributed for the first time. Keep up the good work!Here are the most relevant changes to Rails master for this week." />

  <meta property="og:site_name" content="Ruby on Rails" />
  <meta property="og:title" content="This Week in Rails: Time, Duration fixes and more" />
  <meta property="og:description" content="Happy new year (yet again) ! And a Friday the 13th ðŸ‘»This is Vipul, bringing you the latest from just the second week of the year, which is shaping to be really busy.Thanks to all the 27 contributors, in particular to the 4 people who contributed for the first time. Keep up the good work!Here are the most relevant changes to Rails master for this week." />
  <meta property="og:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta property="og:url" content="http://localhost:4000/2017/1/13/this-week-in-rails-time-duration-fixes-and-more" />
  <meta property="og:type" content="article" />

  <meta name="twitter:title" content="This Week in Rails: Time, Duration fixes and more" />
  <meta name="twitter:description" content="Happy new year (yet again) ! And a Friday the 13th ðŸ‘»This is Vipul, bringing you the latest from just the second week of the year, which is shaping to be really busy.Thanks to all the 27 contributors, in particular to the 4 people who contributed for the first time. Keep up the good work!Here are the most relevant changes to Rails master for this week." />
  <meta name="twitter:image" content="http://localhost:4000/assets/images/opengraph.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:creator" content="@rails" />
  <meta name="twitter:image:alt" content="Ruby on Rails" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/2017/1/13/this-week-in-rails-time-duration-fixes-and-more"
      },
      "name": "Ruby on Rails",
      "headline": "This Week in Rails: Time, Duration fixes and more",
      "description": "Happy new year (yet again) ! And a Friday the 13th ðŸ‘»This is Vipul, bringing you the latest from just the second week of the year, which is shaping to be really busy.Thanks to all the 27 contributors, in particular to the 4 people who contributed for the first time. Keep up the good work!Here are the most relevant changes to Rails master for this week.",
      "url": "http://localhost:4000/2017/1/13/this-week-in-rails-time-duration-fixes-and-more",
      "image": "http://localhost:4000/assets/images/opengraph.png",
      "author": {
        "@type": "Person",
        "name": "vipulnsward"
      },
      "datePublished": "2017-01-13T00:00:00+05:30"
    }
  </script>
  <script defer data-domain="rubyonrails.org" src="https://plausible.io/js/script.js"></script>
  <link rel="icon" href="/assets/images/favicon.png" />
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="The official Ruby on Rails blog">
</head>


<body>


<nav class="nav">
  <a class="nav__logo" href="/" aria-label="Ruby on Rails"></a>

  <input class="nav__checkbox" id="nav__checkbox" type="checkbox" role="button" aria-label="menu" />

  <label class="nav__toggle" for="nav__checkbox">
    <span></span>
  </label>

  <div class="nav__options">
    <div>
      <ul>
        
          
            <li><a href="https://github.com/rails/rails"><span>Source</span></a></li>
          
        
          
            <li><a href="/docs"><span>Docs</span></a></li>
          
        
          
            <li><a href="/community"><span>Community</span></a></li>
          
        
          
            <li><a href="/blog"><span>News</span></a></li>
          
        
      </ul>

      <ul>
        
          
            <li><a href="/world"><span>Events</span></a></li>
          
        
          
            <li><a href="https://jobs.rubyonrails.org"><span>Jobs</span></a></li>
          
        
          
            <li><a href="https://merch.rubyonrails.org"><span>Merch</span></a></li>
          
        
          
            <li><a href="/foundation"><span>Foundation</span></a></li>
          
        
      </ul>
    </div>
  </div>
</nav>


<div class="layout">
  <div class="post common-padding--bottom common-padding--top-small">
    <div class="container">
      <div class="post__headline common-headline">
        <h5>Friday, January 13, 2017</h5>
        <h2>This Week in Rails: Time, Duration fixes and more</h2>

        <h6>Posted by vipulnsward</h6>

      </div>
      <div class="post__content common-content common-content--post">
        <p>Happy new year (yet again) ! And a <strong><em>Friday the 13th</em></strong> ðŸ‘»</p>

<p>This is <a href="https://twitter.com/vipulnsward">Vipul</a>, bringing you the latest from just the second week of the year, which is shaping to be really <a href="https://github.com/rails/rails/compare/master@%7B2016-12-31%7D...@%7B2017-01-13%7D">busy</a>.</p>

<p>Thanks to all the <a href="http://contributors.rubyonrails.org/contributors/in-time-window/20170107-20170113">27 contributors</a>, in particular to the 4 people who contributed for the first time. Keep up the good work!</p>

<p>Here are the most relevant changes to Rails master for this week.</p>

<h2 id="improved">Improved</h2>

<h3 id="constant-look-up-would-no-longer-fall-back-to-top-level-constant-since-ruby-25"><a href="https://github.com/rails/rails/commit/3d91649654ff5570d0cf26f96ec9f82f31fe32f6">Constant look-up would no longer fall back to top-level constant since Ruby 2.5</a></h3>

<p>Since <a href="https://github.com/ruby/ruby/commit/44a2576f798b07139adde2d279e48fdbe71a0148">top-level constant lookup</a> has been removed on Ruby 2.5, Rails takes care of relevant changes on its side, so that we rely on properly scoped constants, instead of relying on fallback lookup.</p>

<h2 id="fixed">Fixed</h2>

<h3 id="fix-pool_from_any_process-to-use-most-recent-specification"><a href="https://github.com/rails/rails/commit/e15a23fa355ed29d70c2ec573cd7b2418f7ac8db">Fix pool_from_any_process to use most recent specification</a></h3>

<p>If a process is forked more than once, the Active Record connection pool was grabbing the oldest connection specification for a process, and not the most recent one.</p>

<p>This issue is not seen for single processes, but if you are forking the process multiple times, the wrong specification will be returned and incorrect connection will be used.</p>

<p>This change fixes the issue by reversing the list of specification names so we can grab the most recent one rather than the oldest.</p>

<h3 id="make-time-travel-work-with-subclasses-of-timedatedatetime"><a href="https://github.com/rails/rails/pull/27616">Make time travel work with subclasses of Time/Date/Datetime</a></h3>

<p>Previously when using time travel methods, travel_to, etc, and calling <code class="language-plaintext highlighter-rouge">now</code> on a subclass of e.g. <code class="language-plaintext highlighter-rouge">Time</code>, it would return an instance of <code class="language-plaintext highlighter-rouge">Time</code> instead of returning an instance of the subclass.</p>

<p>This change fixes the way we return the instance, so that we always return using the correct class.</p>

<h3 id="fix-inconsistent-parsing-of-durations-with-both-months-and-years"><a href="https://github.com/rails/rails/pull/27610">Fix inconsistent parsing of Durations with both months and years</a></h3>

<p>Previously the following code may fail or succeed depending on the current time.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ActiveSupport::Duration.parse(2.months.iso8601) == 2.months  
ActiveSupport::Duration.parse(3.years.iso8601) == 3.years
</code></pre></div></div>

<p>This change fixes the inconsistent parsing so that this comparison no longer fails.</p>

<h2 id="removed">Removed</h2>

<h3 id="deprecate-reflection-class_name-option-to-accept-a-class"><a href="https://github.com/rails/rails/commit/8312a0d22212798864f142b5a94805e0baa6c562">Deprecate reflection class_name option to accept a class</a></h3>

<p>The idea of <code class="language-plaintext highlighter-rouge">class_name</code> as an option of reflection is that passing a string would allow us to lazy autoload the class.</p>

<p>Using the class directly, with something like</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>belongs_to :client, class_name: Customer
</code></pre></div></div>

<p>is eagerloading models more than necessary and creating possible circular dependencies.</p>

<p>This option is now deprecated, pass strings of the class names instead.</p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>Thatâ€™s it from <a href="https://twitter.com/vipulnsward">Vipul</a> . I hope you enjoyed this issue.Â </p>

<p>If you havenâ€™t already, start working on those RailsConf proposals, you have only 6 days left to <a href="http://cfp.railsconf.com/events/railsconf2017">submit a good talk</a>!</p>


      </div>
    </div>
  </div>
</div>

<footer class="footer common-background--grey common-padding--bottom common-padding--top common-shape--top-white-up-left">
  <div class="footer__logo"><a href="/" aria-label="Ruby on Rails"></a></div>

  
</footer>

</body>
</html>
